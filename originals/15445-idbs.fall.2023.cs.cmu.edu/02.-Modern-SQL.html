<!DOCTYPE html>
<html><head><title>02. Modern SQL</title><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:title" content="02. Modern SQL"/><meta property="og:description" content="CMU CS DB Andy Pavlo 교수님의 &amp;quot;Intro. to Database Systems&amp;quot; 강의를 필기한 내용입니다. 강의 본 글의 그림들은 별도의 명시가 없는 한 (1) 해당 강의 자료에서 가져오거나 (2) 주인장이 직접 만들었습니다. 다소 잘못된 내용과 구어적 표현 이 포함되어 있을 수 있습니다."/><meta property="og:image" content="https://mdg.haeramk.im/static/og-image.png"/><meta property="og:width" content="1200"/><meta property="og:height" content="675"/><link rel="icon" href="../../static/icon.png"/><meta name="description" content="CMU CS DB Andy Pavlo 교수님의 &amp;quot;Intro. to Database Systems&amp;quot; 강의를 필기한 내용입니다. 강의 본 글의 그림들은 별도의 명시가 없는 한 (1) 해당 강의 자료에서 가져오거나 (2) 주인장이 직접 만들었습니다. 다소 잘못된 내용과 구어적 표현 이 포함되어 있을 수 있습니다."/><meta name="generator" content="Quartz"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link href="../../index.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://fonts.googleapis.com/css2?family=IBM Plex Mono&amp;family=Gowun Batang:wght@400;700&amp;family=Gowun Dodum:ital,wght@0,400;0,600;1,400;1,600&amp;display=swap" rel="stylesheet" type="text/css" spa-preserve/><script src="../../prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch(`../../static/contentIndex.json`).then(data => data.json())</script></head><body data-slug="originals/15445-idbs.fall.2023.cs.cmu.edu/02.-Modern-SQL"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h1 class="page-title "><a href="../..">Madison Digital Garden</a></h1><div class="spacer mobile-only"></div><div class="search "><div id="search-icon"><p>Search</p><div></div><svg tabIndex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search</title><desc id="desc">Search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg></div><div id="search-container"><div id="search-space"><input autocomplete="off" id="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div id="results-container"></div></div></div></div><div class="darkmode "><input class="toggle" id="darkmode-toggle" type="checkbox" tabIndex="-1"/><label id="toggle-label-light" for="darkmode-toggle" tabIndex="-1"><svg xmlns="http://www.w3.org/2000/svg" xmlnsXlink="http://www.w3.org/1999/xlink" version="1.1" id="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35;" xmlSpace="preserve"><title>Light mode</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg></label><label id="toggle-label-dark" for="darkmode-toggle" tabIndex="-1"><svg xmlns="http://www.w3.org/2000/svg" xmlnsXlink="http://www.w3.org/1999/xlink" version="1.1" id="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'" xmlSpace="preserve"><title>Dark mode</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></label></div></div><div class="center"><div class="page-header"><div class="popover-hint"><h1 class="article-title ">02. Modern SQL</h1><p class="content-meta ">Jul 04, 2024, 24 min read</p><ul class="tags "><li><a href="../../tags/cmu-15445" class="internal tag-link">#cmu-15445</a></li><li><a href="../../tags/database" class="internal tag-link">#database</a></li></ul></div></div><article class="popover-hint"><blockquote class="callout is-collapsible is-collapsed" data-callout="info" data-callout-fold>
<div class="callout-title">
                  <div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg></div>
                  <div class="callout-title-inner"><p>CMU CS DB Andy Pavlo 교수님의 &quot;Intro. to Database Systems&quot; 강의를 필기한 내용입니다. </p></div>
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
                </div>
<ul>
<li><a href="https://youtu.be/n9S4Ibh5O0E?si=he8YVHmloAMXFMPl" class="external">강의</a></li>
</ul>
</blockquote>
<blockquote class="callout" data-callout="info">
<div class="callout-title">
                  <div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg></div>
                  <div class="callout-title-inner"><p>본 글의 그림들은 별도의 명시가 없는 한 (1) 해당 강의 자료에서 가져오거나 (2) 주인장이 직접 만들었습니다. </p></div>
                  
                </div>
</blockquote>
<blockquote class="callout" data-callout="warning">
<div class="callout-title">
                  <div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg></div>
                  <div class="callout-title-inner"><p>다소 잘못된 내용과 구어적 표현 이 포함되어 있을 수 있습니다. </p></div>
                  
                </div>
</blockquote>
<blockquote class="callout is-collapsible is-collapsed" data-callout="tip" data-callout-fold>
<div class="callout-title">
                  <div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg></div>
                  <div class="callout-title-inner"><p>수업에 사용된 SQL </p></div>
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
                </div>
<ul>
<li><a href="https://github.com/haeramkeem/compose-dbms" class="external">여기</a></li>
</ul>
</blockquote>
<h2 id="history">History<a aria-hidden="true" tabindex="-1" href="#history" class="internal"> §</a></h2>
<ul>
<li>저번 시간에도 말한것 처럼 Relational Model 은 어떠한 Programming language 도 제시하지 않았고, 그냥 수학적인 모델일 뿐이었다.</li>
<li>그러다가 IBM 이 1972 년도에 이 Relational Model 을 도입한 Square 라는 언어를 개발했는데,
<ul>
<li>근데 이놈은 문법이 너무 기괴해서 사망띠</li>
</ul>
</li>
<li>그리고 그 이후에 IBM 은 <em>Structured English Query Language</em> 를 줄여 <em>SEQUEL</em> 을 제시했고, 이것이 나중에 <em>SQL</em> 로 발전하게 된다.</li>
<li>추가적으로 UC Berkely 에서 <em>Ingres</em> 라는 DBMS 와 SQL 을 제시했는데, 이것이 발전한게 그 유명한 Postgres 이다. (Post-ingres)</li>
<li>뭐 그리고 IBM 에서는 이후로 SQL 에 기반한 System-38, SQL-DL, DB2 같은 여러 상업 DBMS 를 출시했다고 한다.</li>
<li>SQL 은 1986년에 미국 표준 (ANSI) 로 등록되고, 1987년에는 국제 표준 (ISO) 으로 등록되었으며, 2023년까지도 지속적으로 버전업데이트를 하고 있다고 한다.
<ul>
<li>근데 이건 표준일 뿐이고 각 DBMS 에서 이 표준의 특정 기능을 지원하는지의 여부는 각기 다르다.</li>
<li>거의 모든 DBMS 에 구현된 “최소한의” 기능은 SQL-92 표준이라고 한다.</li>
</ul>
</li>
</ul>
<h2 id="sql">SQL<a aria-hidden="true" tabindex="-1" href="#sql" class="internal"> §</a></h2>
<ul>
<li>대략 네 파트로 나누어 볼 수 있다고 한다.
<ul>
<li><em>Data Management Language</em> (<em>DML</em>): 데이터 다루기 (Insert, select 등등)</li>
<li><em>Data Definition Language</em> (<em>DDL</em>): Scheme 정의 (Create table, view 등)</li>
<li><em>Data Control Language</em> (<em>DCL</em>): 얘는 ACL 같은 거다 - 뭐 접근제어 (보안) 등</li>
<li>그리고 그 외에 <em>Transaction</em> 과 같은 내용들..</li>
</ul>
</li>
<li>그리고 앤디씨가 여기서 짚고 넘어간 점은 SQL 은 <em>Bag</em> 를 다루고 있고, 따라서 중복이 가능하다는 점이다.
<ul>
<li>반면에 Relational algebra 에서는 안된다. (<em>Set</em> 을 다룸)</li>
</ul>
</li>
<li>여담으로 SQL 이라는 표준이 있지만 각 DBMS 에서는 이것을 잘 따르지 않고 지맘대로 한다고 한다.
<ul>
<li>특히 (최근에는 좀 나아졌지만) MySQL 은 진짜 청개구리라네</li>
</ul>
</li>
<li>SQL 은 그 자체로 최대한 많은 것을 제공해 주는 식으로 발전해 왔다고 한다.
<ul>
<li>이게 뭔소리냐면, 가령 어떤 domain 을 변경하는 것은 <code>SELECT</code> 로 데이터를 가져와서 변경한 뒤 다시 <code>INSERT</code> 로 넣는 방식도 가능하다.</li>
<li>하지만 Application code 로 이런 것을 하게 두기 보다는 이런 작업을 SQL 표준으로 만들어서 그냥 <code>UPDATE</code> keyword 만 사용하면 되게끔</li>
<li>즉, DBMS 에서 최대한 많은 것을 해주려는 일종의 맥시멀리즘의 성향을 띈다고 한다.</li>
</ul>
</li>
<li>그럼 이제 SQL 표준의 여러 기능들을 살펴보자.</li>
</ul>
<h2 id="aggregation-function">Aggregation function<a aria-hidden="true" tabindex="-1" href="#aggregation-function" class="internal"> §</a></h2>
<ul>
<li><em>Aggregation function</em> 은 <span class="text-highlight">Bag of tuple 를 input 으로 받아, 하나의 &quot;값&quot; 을 output 으로 주는 함수</span>이다.
<ul>
<li>말만 들으면 복잡한데 아래 예시 보면 별거 아니다.
<ul>
<li><code>AVG(col)</code>: 해당 column 에 대한 평균</li>
<li><code>MIN(col)</code>: 해당 column 에 대한 최소값</li>
<li><code>MAX(col)</code>: 해당 column 에 대한 최대값</li>
<li><code>SUM(col)</code>: 해당 column 에 대한 합계</li>
<li><code>COUNT(anything...)</code>: tuple 들의 개수
<ul>
<li><code>anything...</code> 이라고 적어놓은 것은 column 은 아무래도 상관 없기 때문이다.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>이놈은 <code>SELECT</code> 절에 들어가 결과를 합쳐준다.</li>
<li>가령 <code>COUNT</code> 로 예를 들어 보면</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">COUNT</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> student </span><span style="color:var(--shiki-token-keyword);">WHERE</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">login</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">LIKE</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'%@cs'</span><span style="color:var(--shiki-color-text);">;</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240704221124.png" width="auto" height="auto"/></p>
<ul>
<li>여러개의 Aggregation 을 사용하는 것도 가능하다</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">AVG</span><span style="color:var(--shiki-color-text);">(gpa), </span><span style="color:var(--shiki-token-function);">COUNT</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> student </span><span style="color:var(--shiki-token-keyword);">WHERE</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">login</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">LIKE</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'%@cs'</span><span style="color:var(--shiki-color-text);">;</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240704221141.png" width="auto" height="auto"/></p>
<h2 id="group-by"><code>GROUP BY</code><a aria-hidden="true" tabindex="-1" href="#group-by" class="internal"> §</a></h2>
<ul>
<li>Aggregation 을 사용할 때, <code>SELECT</code> 에 Aggregation 되지 않은 것을 그냥 쓸 수는 없다.</li>
<li>가령 다음 구문은 에러가 난다.</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">AVG</span><span style="color:var(--shiki-color-text);">(s.gpa), e.cid</span></span>
<span data-line><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> enrolled </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> e </span><span style="color:var(--shiki-token-keyword);">JOIN</span><span style="color:var(--shiki-color-text);"> student </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> s</span></span>
<span data-line><span style="color:var(--shiki-token-keyword);">ON</span><span style="color:var(--shiki-color-text);"> e.sid </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> s.sid;</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240704221200.png" width="auto" height="auto"/></p>
<ul>
<li>왜냐면 <code>AVG(s.gpa)</code> 의 경우에는 aggregate 되어 하나의 결과로 나오지만, <code>e.course_id</code> 의 경우에는 하나로 합쳐지지 않기 때문.</li>
<li>그래서 이때는 <code>GROUP BY</code> 를 사용하면 된다.</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">AVG</span><span style="color:var(--shiki-color-text);">(s.gpa), e.cid</span></span>
<span data-line><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> enrolled </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> e </span><span style="color:var(--shiki-token-keyword);">JOIN</span><span style="color:var(--shiki-color-text);"> student </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> s</span></span>
<span data-line><span style="color:var(--shiki-token-keyword);">ON</span><span style="color:var(--shiki-color-text);"> e.sid </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> s.sid</span></span>
<span data-line data-highlighted-line><span style="color:var(--shiki-token-keyword);">GROUP BY</span><span style="color:var(--shiki-color-text);"> e.cid;</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240704221219.png" width="auto" height="auto"/></p>
<ul>
<li>이렇게 하면 같은 <code>e.course_id</code> 를 가지는 row 들이 그루핑되어 해당 그룹에 대한 <code>AVG(s.gpa)</code> 가 계산된다.</li>
<li>즉, <code>GROUP BY</code> 는 <span class="text-highlight">지정해준 column 을 기준으로 subbag 을 만든 뒤, 해당 subbag 에 대해 aggregation 을 할 수 있도록 해주는 키워드</span>이고,</li>
<li><code>SELECT</code> 절에 있는 모든 non-aggregated value 들은 반드시 <code>GROUP BY</code> 로 그루핑되어야 한다.
<ul>
<li>물론 근데 DBMS 마다 조금씩은 차이가 있다.
<ul>
<li>대부분은 에러가 나지만</li>
<li>MySQL 을 <code>&quot;traditional&quot;</code> mode 로 바꾼 경우나</li>
<li>SQLite 의 경우에는 결과가 나오긴 한다.
<ul>
<li>다만 이때는 non-aggregated value 의 경우 그냥 임의로 하나의 값을 고르는 듯 하다; 어떤 값이 나오든 간에 잘못된 행동이고, 에러가 나는게 SQL 표준에 맞는 것이다.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="../../images/Pasted-image-20240704195539.png" width="auto" height="auto"/></p>
<h2 id="having"><code>HAVING</code><a aria-hidden="true" tabindex="-1" href="#having" class="internal"> §</a></h2>
<ul>
<li>만약에 aggregation 의 결과에 대해 조건을 걸기 위해 <code>WHERE</code> 절에 넣으면 어떻게 될까?</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">AVG</span><span style="color:var(--shiki-color-text);">(s.gpa) </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> avg_gpa, e.cid</span></span>
<span data-line><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> enrolled </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> e, student </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> s</span></span>
<span data-line><span style="color:var(--shiki-token-keyword);">WHERE</span><span style="color:var(--shiki-color-text);"> e.sid </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> s.sid</span></span>
<span data-line data-highlighted-line><span style="color:var(--shiki-token-keyword);">AND</span><span style="color:var(--shiki-color-text);"> avg_gpa </span><span style="color:var(--shiki-token-keyword);">></span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">3</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">9</span></span>
<span data-line><span style="color:var(--shiki-token-keyword);">GROUP BY</span><span style="color:var(--shiki-color-text);"> e.cid;</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240704221401.png" width="auto" height="auto"/></p>
<ul>
<li>보다시피 에러가 난다.
<ul>
<li>이것은 Aggregation 이 마지막에 수행되기 때문에, <code>WHERE</code> 절에서는 <code>avg_gpa</code> 가 뭔지 모르기 때문.</li>
</ul>
</li>
<li>이때 <code>HAVING</code> 을 사용하면 된다.</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">AVG</span><span style="color:var(--shiki-color-text);">(s.gpa) </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> avg_gpa, e.cid</span></span>
<span data-line><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> enrolled </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> e, student </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> s</span></span>
<span data-line><span style="color:var(--shiki-token-keyword);">WHERE</span><span style="color:var(--shiki-color-text);"> e.sid </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> s.sid</span></span>
<span data-line><span style="color:var(--shiki-token-keyword);">GROUP BY</span><span style="color:var(--shiki-color-text);"> e.cid</span></span>
<span data-line data-highlighted-line><span style="color:var(--shiki-token-keyword);">HAVING</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">AVG</span><span style="color:var(--shiki-color-text);">(s.gpa) </span><span style="color:var(--shiki-token-keyword);">></span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">3</span><span style="color:var(--shiki-color-text);">.</span><span style="color:var(--shiki-token-constant);">9</span><span style="color:var(--shiki-color-text);">;</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240704221732.png" width="auto" height="auto"/></p>
<ul>
<li>다만 이때는 주의할 점이 있다.
<ul>
<li><code>HAVING</code> 절은 <code>GROUP BY</code> 다음에 와야 한다. 이전에 오면 에러남</li>
<li><code>HAVING</code> 절에는 <code>AS</code> 로 지정된 alias 를 사용할 수는 없다. 이것도 “column 을 찾을 수 없다” 는 에러가 난다.
<ul>
<li>참고로 내부 optimizer 에 의해 알아서 최적화 되기 때문에, 이렇게 한다고 해서 <code>AVG</code> 가 두번 연산되지는 않는다.</li>
</ul>
</li>
</ul>
</li>
<li>즉, <code>HAVING</code> 은 <span class="text-highlight">Aggregation 에 대해 필터링을 하고 싶을 때 사용하는 문법</span>이다.</li>
</ul>
<h2 id="string">String<a aria-hidden="true" tabindex="-1" href="#string" class="internal"> §</a></h2>
<h3 id="constant">Constant<a aria-hidden="true" tabindex="-1" href="#constant" class="internal"> §</a></h3>
<ul>
<li>문자열에 관해 SQL-92 에 명시된 표준은 Single quote (<code>''</code>) 에 Case-sensitive 이다.</li>
<li>하지만 (당연하게도?) 모든 DBMS 에서 이것을 따르지는 않는다.</li>
</ul>






























<table><thead><tr><th>NAME</th><th>CASE</th><th>QUOTE</th></tr></thead><tbody><tr><td>SQL-92</td><td>Sensitive</td><td>Single quote</td></tr><tr><td>Postgres/MSSQL/Oracle</td><td>Sensitive</td><td>Single quote</td></tr><tr><td>MySQL</td><td>Insensitive</td><td>Single/Double quote</td></tr><tr><td>SQLite</td><td>Sensitive</td><td>Single/Double quote</td></tr></tbody></table>
<ul>
<li>저 괘씸한 놈을 한번 확인해 보자.</li>
<li>먼저 PostgreSQL 은:</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&quot;good&quot;</span><span style="color:var(--shiki-color-text);">;</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240705112021.png" width="auto" height="auto"/></p>
<ul>
<li>SQL-92 를 잘 따르고 있는 것을 확인할 수 있다.</li>
<li>하지만 MySQL 은?</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">MySQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&quot;good&quot;</span><span style="color:var(--shiki-color-text);">;</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240705112132.png" width="auto" height="auto"/></p>
<ul>
<li><code>&quot;&quot;</code> 도 사용 가능하다.</li>
<li>또한 대소문자도 확인해 보자.</li>
<li>우선 PostgreSQL 은:</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> student </span><span style="color:var(--shiki-token-keyword);">WHERE</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">name</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'RzA'</span><span style="color:var(--shiki-color-text);">;</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240705112401.png" width="auto" height="auto"/></p>
<ul>
<li>역시나 결과가 나오지 않는다. (<code>'RZA'</code> 가 올바른 값이다.)</li>
<li>하지만 MySQL 은:</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">MySQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> student </span><span style="color:var(--shiki-token-keyword);">WHERE</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">name</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'RzA'</span><span style="color:var(--shiki-color-text);">;</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240705112534.png" width="auto" height="auto"/></p>
<ul>
<li>역시나 자기 맘대로 하는 것을 볼 수 있다.</li>
<li>MySQL 에서는 대소문자를 구별하려면 다음처럼 하면 된다.</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">MySQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> student </span><span style="color:var(--shiki-token-keyword);">WHERE</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">CAST</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-keyword);">name</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">BINARY</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'RzA'</span><span style="color:var(--shiki-color-text);">;</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240705113238.png" width="auto" height="auto"/></p>
<h3 id="like"><code>LIKE</code><a aria-hidden="true" tabindex="-1" href="#like" class="internal"> §</a></h3>
<ul>
<li>String matching 기능. 뭐 별거 없다. <code>LIKE</code> 뒤에 다음의 것들을 이용해 pattern 을 적어주면 된다.
<ul>
<li><code>%</code> 는 임의 길이의 substring 과 매칭되고,</li>
<li><code>_</code> 는 subchar 하나와 매칭된다.</li>
</ul>
</li>
<li>예를 들어:</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> student </span><span style="color:var(--shiki-token-keyword);">WHERE</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">login</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">LIKE</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'s%c_'</span><span style="color:var(--shiki-color-text);">;</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240705160521.png" width="auto" height="auto"/></p>
<h3 id="functions">Functions<a aria-hidden="true" tabindex="-1" href="#functions" class="internal"> §</a></h3>
<ul>
<li><code>SUBSTRING()</code>: 말 그대로 substring 추출하는 것.</li>
<li><code>UPPER()</code>, <code>LOWER()</code>: 말 그대로 대소문자 변경하는 것.</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">name</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-function);">SUBSTRING</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-keyword);">name</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-constant);">3</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> substr,</span></span>
<span data-line><span style="color:var(--shiki-token-function);">UPPER</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-keyword);">name</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> up,</span></span>
<span data-line><span style="color:var(--shiki-token-function);">LOWER</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-keyword);">name</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> low</span></span>
<span data-line><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> student </span><span style="color:var(--shiki-token-keyword);">WHERE</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">sid</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">53655</span><span style="color:var(--shiki-color-text);">;</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240705161153.png" width="auto" height="auto"/></p>
<h3 id="concat">Concat<a aria-hidden="true" tabindex="-1" href="#concat" class="internal"> §</a></h3>
<ul>
<li>String concat 은 SQL-92 표준으로는 <code>||</code> 이다. 하지만,
<ul>
<li>MSSQL 은 <code>+</code> 를 사용하고,</li>
<li>MySQL 은 이런 기능이 없어 <code>CONCAT()</code> 함수를 사용한다.</li>
</ul>
</li>
<li>MySQL 로 해보자.</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">MySQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">name</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> student </span><span style="color:var(--shiki-token-keyword);">WHERE</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">login</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">name</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">||</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'@cs'</span><span style="color:var(--shiki-color-text);">;</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240705161532.png" width="auto" height="auto"/></p>
<ul>
<li>보다시피 에러가 난다.</li>
<li>하지만 <code>CONCAT()</code> 을 사용하면,</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">MySQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">name</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> student </span><span style="color:var(--shiki-token-keyword);">WHERE</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">login</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">CONCAT</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-function);">LOWER</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-keyword);">name</span><span style="color:var(--shiki-color-text);">), </span><span style="color:var(--shiki-token-string-expression);">'@cs'</span><span style="color:var(--shiki-color-text);">);</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240705161632.png" width="auto" height="auto"/></p>
<h2 id="date--time">Date &amp; Time<a aria-hidden="true" tabindex="-1" href="#date--time" class="internal"> §</a></h2>
<ul>
<li>이것 또한 각 DBMS 마다 지멋대로인 것 중 하나이다.</li>
</ul>
<h3 id="현재-날짜-시간">현재 날짜, 시간<a aria-hidden="true" tabindex="-1" href="#현재-날짜-시간" class="internal"> §</a></h3>
<ul>
<li>일단 현재 날짜와 시간을 구하는 것부터 큰일이다.
<ul>
<li><code>NOW()</code> 와</li>
<li><code>CURRENT_TIMESTAMP</code> 는 키워드도 있고 함수 (<code>CURRENT_TIMESTAMP()</code>) 도 있다.</li>
</ul>
</li>
</ul>









































<table><thead><tr><th>DBMS</th><th><code>NOW()</code></th><th><code>CURRENT_TIMESTAMP</code></th><th><code>CURRENT_TIMESTAMP()</code></th></tr></thead><tbody><tr><td>DuckDB</td><td>O</td><td>O</td><td>X</td></tr><tr><td>MySQL</td><td>O</td><td>O</td><td>O</td></tr><tr><td>Oracle</td><td>X</td><td>O</td><td>X</td></tr><tr><td>PostgreSQL</td><td>O</td><td>O</td><td>X</td></tr><tr><td>SQLite</td><td>X</td><td>O</td><td>X</td></tr></tbody></table>
<h3 id="string---date-변환">String -> Date 변환<a aria-hidden="true" tabindex="-1" href="#string---date-변환" class="internal"> §</a></h3>
<ul>
<li><code>VARCHAR</code> 로 표현된 날짜를 Date 객체로 바꾸는 것은, <code>DATE()</code> 함수나 <code>CAST(... AS DATE)</code> 를 사용하면 된다.</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">MySQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">DATE</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">'2024-07-05'</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> func, </span><span style="color:var(--shiki-token-function);">CAST</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">'2024-07-05'</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">DATE</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> cast;</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240705165926.png" width="auto" height="auto"/></p>
<ul>
<li>그런데 PostgreSQL (+ 그리고 이놈을 이어받은 DuckDB 같은 애들) 은 <code>::date</code> 라는 또 다른 문법적 설탕을 제공한다.
<ul>
<li>근데 이게 왜 설탕인지는 모르겠다; 장점이 없는디</li>
</ul>
</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">DATE</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">'2024-07-05'</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> func, </span><span style="color:var(--shiki-token-string-expression);">'2024-07-05'</span><span style="color:var(--shiki-color-text);">::</span><span style="color:var(--shiki-token-keyword);">date</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> sugar;</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240705165628.png" width="auto" height="auto"/></p>
<h3 id="날짜-차이">날짜 차이<a aria-hidden="true" tabindex="-1" href="#날짜-차이" class="internal"> §</a></h3>
<ul>
<li>두 날짜 간의 차이를 구하는 것을 해보자.</li>
<li>PostgreSQL 에서는 그냥 <code>DATE</code> 간에 뺼셈을 해주면 된다.</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">DATE</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">'2024-07-05'</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-keyword);">-</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">DATE</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">'2024-01-01'</span><span style="color:var(--shiki-color-text);">);</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240705171236.png" width="auto" height="auto"/></p>
<ul>
<li>근데 MySQL 에서는 이렇게 하면 안된다.</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">MySQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">DATE</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">'2024-07-05'</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-keyword);">-</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">DATE</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">'2024-01-01'</span><span style="color:var(--shiki-color-text);">);</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240705171315.png" width="auto" height="auto"/></p>
<ul>
<li>저 <code>604</code> 라는 값은 7월 과 1월의 차이 (<code>6</code>) 과 5일과 1일의 차이 (<code>04</code>) 로 도출된 이상한 값이다.</li>
<li>MySQL 에서는 UNIX time 으로 바꿔서 계산하거나</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">MySQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">ROUND</span><span style="color:var(--shiki-color-text);">((UNIX_TIMESTAMP(</span><span style="color:var(--shiki-token-string-expression);">'2024-07-05'</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-keyword);">-</span><span style="color:var(--shiki-color-text);"> UNIX_TIMESTAMP(</span><span style="color:var(--shiki-token-string-expression);">'2024-01-01'</span><span style="color:var(--shiki-color-text);">)) </span><span style="color:var(--shiki-token-keyword);">/</span><span style="color:var(--shiki-color-text);"> (</span><span style="color:var(--shiki-token-constant);">60</span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-token-constant);">60</span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-token-constant);">24</span><span style="color:var(--shiki-color-text);">));</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240705171714.png" width="auto" height="auto"/></p>
<ul>
<li>아니면 <code>DATEDIFF</code> 를 사용하면 된다.</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">MySQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">DATEDIFF</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-keyword);">DATE</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">'2024-07-05'</span><span style="color:var(--shiki-color-text);">), </span><span style="color:var(--shiki-token-keyword);">DATE</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">'2024-01-01'</span><span style="color:var(--shiki-color-text);">));</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240705171853.png" width="auto" height="auto"/></p>
<ul>
<li>물론 근데 이건 MySQL 에만 있는 기능인 것 같다.</li>
<li>SQLite 에서는 <code>julianday()</code> 함수로 율리우스력으로 바꿔서 계산할 수 있다고 한다.</li>
</ul>
<p><img src="../../images/Pasted-image-20240705172054.png" width="auto" height="auto"/></p>
<h3 id="extract"><code>EXTRACT</code><a aria-hidden="true" tabindex="-1" href="#extract" class="internal"> §</a></h3>
<ul>
<li><code>DATE</code> 객체에서 특정 값을 뽑아내는 함수이다.</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> EXTRACT(</span><span style="color:var(--shiki-token-keyword);">DAY</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">DATE</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">'2024-07-05'</span><span style="color:var(--shiki-color-text);">));</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240706103950.png" width="auto" height="auto"/></p>
<h2 id="왜-이렇게-문법이-지멋대로일까">왜 이렇게 문법이 지멋대로일까<a aria-hidden="true" tabindex="-1" href="#왜-이렇게-문법이-지멋대로일까" class="internal"> §</a></h2>
<ul>
<li>일단 너무나 많은 DBMS 들이 있고 그 중에서 선두주자가 없기 때문이다.
<ul>
<li>이전에는 IBM 이라는 큰 기업이 있었고 여기에서 만든 SQL 이 표준으로 채택되긴 했지만</li>
<li>지금은 DBMS 에서는 그렇다 할 리딩DB 가 없기 때문</li>
</ul>
</li>
<li>또한 큰 기업이라 할지라도 공통의 표준을 만드는 것은 어렵기 때문이다.
<ul>
<li>가령 구글이 <a href="https://github.com/google/zetasql" class="external">ZetaSQL</a> 라는 자기들만의 SQL 문법을 제시헀지만</li>
<li>망한 것을 보면 알 수 있다.</li>
</ul>
</li>
<li>지금의 SQL 표준을 정할 때는 표준을 정한 뒤 나머지 DBMS 들이 채택하는 것과는 반대로 진행된다.
<ul>
<li>즉, 이미 DBMS 들에서는 나름대로 다 구현해 놓고,</li>
<li>그 기능에 대해 DBMS 들 간에 경쟁 (?) 을 통해 자신들의 구현본을 표준에 집어넣으려고 한다고 한다.</li>
<li>가령 최근의 SQL-2023 에 등록된 Graph query 의 경우에는 Oracle 이 제안해서 추가된 기능이다.</li>
</ul>
</li>
</ul>
<h2 id="window-function">Window function<a aria-hidden="true" tabindex="-1" href="#window-function" class="internal"> §</a></h2>
<ul>
<li>Aggregation 은 여러개의 tuple 을 모아 하나의 결과를 내는 것이었다면</li>
<li>Window 는 여러개의 tuple 에 대해 무언가를 해 각각의 tuple 에 대해 결과를 내는 것이다.</li>
<li>잘 이해가 안된다면 대표적인 예시인 <code>RANK()</code> 를 생각하면 된다.
<ul>
<li>여러 tuple 들에 대해 순위를 매겨 각 tuple 별로 결과가 나오기 때문.</li>
</ul>
</li>
<li>기본적인 문법은 <code>함수이름() OVER()</code> 형식이다.
<ul>
<li>저기 <code>OVER()</code> 를 통해 고려할 tuple 들의 범위를 지정하거나, 추가적인 정보를 주게 된다.</li>
</ul>
</li>
<li>더 자세한 것은 아래 각 함수들을 이용해 살펴보자.</li>
</ul>
<h3 id="row_number"><code>ROW_NUMBER()</code><a aria-hidden="true" tabindex="-1" href="#row_number" class="internal"> §</a></h3>
<ul>
<li>말 그대로 줄 번호를 출력하는 것이다.</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-function);">ROW_NUMBER</span><span style="color:var(--shiki-color-text);">() </span><span style="color:var(--shiki-token-keyword);">OVER</span><span style="color:var(--shiki-color-text);">() </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> enrolled;</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240706111753.png" width="auto" height="auto"/></p>
<ul>
<li>당연한 얘기지만 이 값을 PK 로 사용할 수는 없다.
<ul>
<li>단순하게 화면에 출력되는 순서에 관한 것이고, 순서가 바뀌면 각 tuple 에 대한 <code>ROW_NUMBER()</code> 도 달라질 수 있기 때문.</li>
</ul>
</li>
</ul>
<h3 id="over-partition-by"><code>OVER()</code>, <code>PARTITION BY</code><a aria-hidden="true" tabindex="-1" href="#over-partition-by" class="internal"> §</a></h3>
<ul>
<li>Window function 을 사용할 때 <code>OVER()</code> 를 통해 범위를 지정해 줄 수 있고,</li>
<li><code>PARTITION BY</code> 는 aggregation 에서의 <code>GROUP BY</code> 와 유사한 기능을 해준다.
<ul>
<li>즉, 이것을 통해 window function 을 적용할 그룹을 지어줄 수 있는 것.</li>
</ul>
</li>
<li>예시를 보자.</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-function);">ROW_NUMBER</span><span style="color:var(--shiki-color-text);">() </span><span style="color:var(--shiki-token-keyword);">OVER</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-keyword);">PARTITION</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">BY</span><span style="color:var(--shiki-color-text);"> cid) </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> enrolled;</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240708102351.png" width="auto" height="auto"/></p>
<ul>
<li>보다시피 <code>cid</code> 별로 그룹지어져 <code>ROW_NUMBER()</code> 가 계산된 것을 알 수 있다.</li>
</ul>
<h3 id="order-by"><code>ORDER BY</code><a aria-hidden="true" tabindex="-1" href="#order-by" class="internal"> §</a></h3>
<h4 id="기본-사용법">기본 사용법<a aria-hidden="true" tabindex="-1" href="#기본-사용법" class="internal"> §</a></h4>
<ul>
<li>이건 Window function 에 국한된 기능은 아니긴 한데</li>
<li>어쨋든 말 그대로 결과를 정렬하는 기능이다.</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> enrolled </span><span style="color:var(--shiki-token-keyword);">ORDER BY</span><span style="color:var(--shiki-color-text);"> cid;</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240708103430.png" width="auto" height="auto"/></p>
<h4 id="정렬-옵션">정렬 옵션<a aria-hidden="true" tabindex="-1" href="#정렬-옵션" class="internal"> §</a></h4>
<ul>
<li>기본적으로는 보다시피 오름차순으로 정렬하고, 이것은 <code>ASC</code> 옵션을 사용한 것과 같다.</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> enrolled </span><span style="color:var(--shiki-token-keyword);">ORDER BY</span><span style="color:var(--shiki-color-text);"> cid </span><span style="color:var(--shiki-token-keyword);">ASC</span><span style="color:var(--shiki-color-text);">;</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240708103911.png" width="auto" height="auto"/></p>
<ul>
<li>내림차순으로 정렬하기 위해서는 <code>DESC</code> 옵션을 사용하면 된다.</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> enrolled </span><span style="color:var(--shiki-token-keyword);">ORDER BY</span><span style="color:var(--shiki-color-text);"> cid </span><span style="color:var(--shiki-token-keyword);">DESC</span><span style="color:var(--shiki-color-text);">;</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240708103940.png" width="auto" height="auto"/></p>
<h4 id="over-연동"><code>OVER()</code> 연동<a aria-hidden="true" tabindex="-1" href="#over-연동" class="internal"> §</a></h4>
<ul>
<li><code>ORDER BY</code> 는 아래처럼 <code>OVER()</code> 안에 넣어 정렬 후 Window function 을 굴릴 수도 있다.</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-function);">ROW_NUMBER</span><span style="color:var(--shiki-color-text);">() </span><span style="color:var(--shiki-token-keyword);">OVER</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-keyword);">ORDER BY</span><span style="color:var(--shiki-color-text);"> cid) </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> enrolled;</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240708102906.png" width="auto" height="auto"/></p>
<ul>
<li>결과만 보면 <code>ORDER BY</code> 를 <code>OVER()</code> 안에 넣는 것이나 빼는 것이나 다를 바가 없어 보이지만, 차이점은 언제 정렬을 하냐에 달려 있다.</li>
<li>가령 다음의 문장은 <code>cid</code> 로 정렬해서 <code>ROW_NUMER()</code> 를 계산한 뒤, 그 결과를 <code>grade</code> 에 따라 정렬해서 출력하게 된다.</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-function);">ROW_NUMBER</span><span style="color:var(--shiki-color-text);">() </span><span style="color:var(--shiki-token-keyword);">OVER</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-keyword);">ORDER BY</span><span style="color:var(--shiki-color-text);"> cid) </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> enrolled </span><span style="color:var(--shiki-token-keyword);">ORDER BY</span><span style="color:var(--shiki-color-text);"> grade;</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240708104326.png" width="auto" height="auto"/></p>
<h3 id="rank"><code>RANK()</code><a aria-hidden="true" tabindex="-1" href="#rank" class="internal"> §</a></h3>
<ul>
<li>근데 어떤 것의 순위를 매길 때는 <code>RANK()</code> 함수를 더 많이 사용한다.</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-function);">RANK</span><span style="color:var(--shiki-color-text);">() </span><span style="color:var(--shiki-token-keyword);">OVER</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-keyword);">ORDER BY</span><span style="color:var(--shiki-color-text);"> grade) </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> enrolled;</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240708104634.png" width="auto" height="auto"/></p>
<ul>
<li>근데 보면 어차피 <code>ORDER BY</code> 를 사용해야 하는 것은 매한가지인데 이때 <code>ROW_NUMBER()</code> 를 사용하는 것과 <code>RANK()</code> 를 사용하는 것 간에 어떤 차이점이 있을 까?
<ul>
<li>이건 주인장도 모르겠다. 딱히 문법적 설탕도 아닌 거시 요상혀</li>
</ul>
</li>
</ul>
<h4 id="복잡한-용례">복잡한 용례<a aria-hidden="true" tabindex="-1" href="#복잡한-용례" class="internal"> §</a></h4>
<ul>
<li>Course 별 2번째로 성적이 높은 학생들만을 출력한다고 해보자.</li>
<li>그럼 일단 Course 별로 성적을 정렬한다.</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-function);">RANK</span><span style="color:var(--shiki-color-text);">() </span><span style="color:var(--shiki-token-keyword);">OVER</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-keyword);">PARTITION</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">BY</span><span style="color:var(--shiki-color-text);"> cid </span><span style="color:var(--shiki-token-keyword);">ORDER BY</span><span style="color:var(--shiki-color-text);"> grade </span><span style="color:var(--shiki-token-keyword);">ASC</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> rank </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> enrolled;</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240708105249.png" width="auto" height="auto"/></p>
<ul>
<li>그 다음에 이 결과에서 <code>rank</code> 가 <code>2</code> 인 결과들을 필터링하면 될 것이야.</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line data-highlighted-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> (</span></span>
<span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-function);">RANK</span><span style="color:var(--shiki-color-text);">() </span><span style="color:var(--shiki-token-keyword);">OVER</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-keyword);">PARTITION</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">BY</span><span style="color:var(--shiki-color-text);"> cid </span><span style="color:var(--shiki-token-keyword);">ORDER BY</span><span style="color:var(--shiki-color-text);"> grade </span><span style="color:var(--shiki-token-keyword);">ASC</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> rank </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> enrolled</span></span>
<span data-line data-highlighted-line><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> ranking </span><span style="color:var(--shiki-token-keyword);">WHERE</span><span style="color:var(--shiki-color-text);"> ranking.rank </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">2</span><span style="color:var(--shiki-color-text);">;</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240708105524.png" width="auto" height="auto"/></p>
<h2 id="nested-sub-query">Nested (Sub) query<a aria-hidden="true" tabindex="-1" href="#nested-sub-query" class="internal"> §</a></h2>
<ul>
<li><em>Nested query</em> (<em>Subsuery</em>) 는 말 그대로 하나의 query 안에 또 다른 query 가 들어가는 것이다.</li>
<li>이것은 query 내의 어디든 들어갈 수 있다.
<ul>
<li><code>FROM</code> 절에도 가능하고</li>
<li><code>WHERE</code> 에도 가능하는 등</li>
</ul>
</li>
<li><em>Nested query</em> 에서 바깥에 있는 query 를 <em>Outer query</em> 라고 하고, 안에 들어가 있는 query 를 <em>Inner query</em> 라고 한다.
<ul>
<li>가령 다음의 예시에서 <code>SELECT name ...</code> 이 <em>Outer query</em> 이고,</li>
<li><code>SELECT sid ...</code> 이 <em>Inner query</em> 이다.</li>
</ul>
</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">name</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> student </span><span style="color:var(--shiki-token-keyword);">WHERE</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">sid</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">IN</span><span style="color:var(--shiki-color-text);"> (</span></span>
<span data-line data-highlighted-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">sid</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> enrolled </span><span style="color:var(--shiki-token-keyword);">WHERE</span><span style="color:var(--shiki-color-text);"> cid </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'15-445'</span></span>
<span data-line><span style="color:var(--shiki-color-text);">);</span></span></code></pre></div>
<ul>
<li>위 문장에서는 <code>sid</code> 가 두번 등장하는데, 첫번째 <code>sid</code> 는 <code>student</code> 테이블을 가리키고 두번째는 <code>enrolled</code> 테이블을 가리킨다.</li>
<li>이렇듯 각 DBMS 의 SQL 파서는 “문맥” 을 파악해 어떤 attribute 가 어떤 relation 의 것을 가리키는지 파악한다고 한다.
<ul>
<li>만일 파악에 실패한 경우라면, 좀 더 구체적으로 작성해 달라는 에러를 출력하게 된다.</li>
</ul>
</li>
<li>이 <em>Nested query</em> 는 강력한 기능이긴 하지만, DBMS 로 하여금 성능을 최적화 하기에는 매우 어려운 부분이라고 한다.</li>
<li>그리고 위 문장은 기본적으로 두 테이블을 <code>JOIN</code> 하는 것이나 마찬가지이다.
<ul>
<li>어떤 게 더 좋을지는 모르겠음; 알아서 최적화되어있으려나</li>
</ul>
</li>
</ul>
<h3 id="operators">Operators<a aria-hidden="true" tabindex="-1" href="#operators" class="internal"> §</a></h3>
<ul>
<li>Inner query 를 Outer query 에서 사용할 때의 연산자가 몇개 있다.</li>
</ul>
<h4 id="any-in"><code>ANY</code>, <code>IN</code><a aria-hidden="true" tabindex="-1" href="#any-in" class="internal"> §</a></h4>
<ul>
<li><code>=ANY()</code>: 이것은 왼쪽의 값이 오른쪽의 Inner query 의 결과에 포함되어 있으면 참으로 판단한다.</li>
<li>다음의 쿼리를 보자.</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">name</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> student </span><span style="color:var(--shiki-token-keyword);">WHERE</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">sid</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> ANY (</span></span>
<span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">sid</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> enrolled </span><span style="color:var(--shiki-token-keyword);">WHERE</span><span style="color:var(--shiki-color-text);"> cid </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'15-445'</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">OR</span><span style="color:var(--shiki-color-text);"> cid </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'15-721'</span></span>
<span data-line><span style="color:var(--shiki-color-text);">);</span></span></code></pre></div>
<ul>
<li>이 쿼리에서의 Inner query 인 다음의 문장의 결과를 다음처럼 나오는데</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">sid</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> enrolled </span><span style="color:var(--shiki-token-keyword);">WHERE</span><span style="color:var(--shiki-color-text);"> cid </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'15-445'</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">OR</span><span style="color:var(--shiki-color-text);"> cid </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'15-721'</span><span style="color:var(--shiki-color-text);">;</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240708114230.png" width="auto" height="auto"/></p>
<ul>
<li>이때 <code>student</code> 테이블의 tuple 을 하나하나 검사해 sid 가 위의 결과에 포함되어 있으면 참으로 판단해 결과에 포함시키는 것이다.</li>
<li>결과적으로 다음과 같이 출력된다.</li>
</ul>
<p><img src="../../images/Pasted-image-20240708114435.png" width="auto" height="auto"/></p>
<ul>
<li><code>IN()</code> 은 <code>=ANY()</code> 의 문법적 설탕이다.
<ul>
<li>위의 예시를 <code>IN</code> 으로 고쳐도 결과는 같다.</li>
</ul>
</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">name</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> student </span><span style="color:var(--shiki-token-keyword);">WHERE</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">sid</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">IN</span><span style="color:var(--shiki-color-text);"> (</span></span>
<span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">sid</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> enrolled </span><span style="color:var(--shiki-token-keyword);">WHERE</span><span style="color:var(--shiki-color-text);"> cid </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'15-445'</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">OR</span><span style="color:var(--shiki-color-text);"> cid </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'15-721'</span></span>
<span data-line><span style="color:var(--shiki-color-text);">);</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240708114033.png" width="auto" height="auto"/></p>
<h4 id="all"><code>ALL</code><a aria-hidden="true" tabindex="-1" href="#all" class="internal"> §</a></h4>
<ul>
<li>Subquery 의 모든 출력 결과에 부합해야 한다.</li>
<li>예를 들면 다음과 같은 query 가 가능하다.</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> student </span><span style="color:var(--shiki-token-keyword);">WHERE</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">sid</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> ALL (</span></span>
<span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">sid</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> enrolled </span><span style="color:var(--shiki-token-keyword);">WHERE</span><span style="color:var(--shiki-color-text);"> enrollment_id </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span></span>
<span data-line><span style="color:var(--shiki-color-text);">);</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240708132806.png" width="auto" height="auto"/></p>
<ul>
<li>하지만 <code>enrollment_id > 1</code> 가 되면 여러 <code>sid</code> 가 조회되고, 이들과 부합하는 학생은 없기 때문에 아무런 결과도 나오지 않는다.</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> student </span><span style="color:var(--shiki-token-keyword);">WHERE</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">sid</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> ALL (</span></span>
<span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">sid</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> enrolled </span><span style="color:var(--shiki-token-keyword);">WHERE</span><span style="color:var(--shiki-color-text);"> enrollment_id </span><span style="color:var(--shiki-token-keyword);">></span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span></span>
<span data-line><span style="color:var(--shiki-color-text);">);</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240708132940.png" width="auto" height="auto"/></p>
<h4 id="exists"><code>EXISTS</code><a aria-hidden="true" tabindex="-1" href="#exists" class="internal"> §</a></h4>
<ul>
<li>Subquery 의 결과가 존재해야 한다.</li>
<li>가령 (별로 좋은 예시는 아닌 것 같지만) 다음의 예시가 가능하다.
<ul>
<li>여기서는 subquery 가 false 이기 때문에, 아무런 tuple 도 출력되지 않는다.</li>
</ul>
</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> student </span><span style="color:var(--shiki-token-keyword);">WHERE</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">EXISTS</span><span style="color:var(--shiki-color-text);"> (</span></span>
<span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">sid</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> enrolled </span><span style="color:var(--shiki-token-keyword);">WHERE</span><span style="color:var(--shiki-color-text);"> enrollment_id </span><span style="color:var(--shiki-token-keyword);">&lt;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span></span>
<span data-line><span style="color:var(--shiki-color-text);">);</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240708133209.png" width="auto" height="auto"/></p>
<h2 id="explain"><code>EXPLAIN</code><a aria-hidden="true" tabindex="-1" href="#explain" class="internal"> §</a></h2>
<ul>
<li>이 키워드는 어떤 query 를 실행할 때의 query plan 을 출력하는 기능이다.
<ul>
<li>즉, 요청한 query 가 optimizer 를 거쳐 실제로 어떻게 처리되는지를 보여준다.</li>
</ul>
</li>
<li>예를 들어 PostgreSQL 에서는:</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-color-text);">EXPLAIN </span><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">name</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> student </span><span style="color:var(--shiki-token-keyword);">WHERE</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">sid</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">IN</span><span style="color:var(--shiki-color-text);"> (</span></span>
<span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">sid</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> enrolled </span><span style="color:var(--shiki-token-keyword);">WHERE</span><span style="color:var(--shiki-color-text);"> cid </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'15-445'</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">OR</span><span style="color:var(--shiki-color-text);"> cid </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'15-721'</span></span>
<span data-line><span style="color:var(--shiki-color-text);">);</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240708134036.png" width="auto" height="auto"/></p>
<ul>
<li>그리고 MySQL 의 경우에는:</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">MySQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-color-text);">EXPLAIN </span><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">name</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> student </span><span style="color:var(--shiki-token-keyword);">WHERE</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">sid</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">IN</span><span style="color:var(--shiki-color-text);"> (</span></span>
<span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">sid</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> enrolled </span><span style="color:var(--shiki-token-keyword);">WHERE</span><span style="color:var(--shiki-color-text);"> cid </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'15-445'</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">OR</span><span style="color:var(--shiki-color-text);"> cid </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'15-721'</span></span>
<span data-line><span style="color:var(--shiki-color-text);">);</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240708134156.png" width="auto" height="auto"/></p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> cid, </span><span style="color:var(--shiki-token-function);">COUNT</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> enrolled </span><span style="color:var(--shiki-token-keyword);">GROUP BY</span><span style="color:var(--shiki-color-text);"> cid;</span></span></code></pre></div>
<h2 id="lateral"><code>LATERAL</code><a aria-hidden="true" tabindex="-1" href="#lateral" class="internal"> §</a></h2>
<ul>
<li><code>LATERAL</code> 은 Join 의 한 종류인데 외부의 alias 를 가져다 쓸 수 있게 해주는 Join 이다.</li>
<li>가령 다음의 문장은 에러가 난다.</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> (</span><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> x) </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> t1, (</span><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> t1.x </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> y) </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> t2;</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240708140825.png" width="auto" height="auto"/></p>
<ul>
<li>이때에는 저기 에러문구에도 친절하게 적혀있듯이, <code>LATERAL</code> 을 사용하면 된다.</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span></span>
<span data-line><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> x) </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> t1,</span></span>
<span data-line data-highlighted-line><span style="color:var(--shiki-color-text);">LATERAL (</span><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> t1.x </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> y) </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> t2;</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240708140927.png" width="auto" height="auto"/></p>
<h3 id="예제1">예제1<a aria-hidden="true" tabindex="-1" href="#예제1" class="internal"> §</a></h3>
<ul>
<li>모든 course 정보를 출력하고, 각 course 에 대해 등록한 student 들의 명수와 student 들의 평균 GPA 를 출력하라</li>
</ul>
<blockquote class="callout is-collapsible is-collapsed" data-callout="tip" data-callout-fold>
<div class="callout-title">
                  <div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg></div>
                  <div class="callout-title-inner"><p>정답 </p></div>
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
                </div>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> course </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> c,</span></span>
<span data-line><span style="color:var(--shiki-color-text);">LATERAL (</span><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">COUNT</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> cnt </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> enrolled </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> e </span><span style="color:var(--shiki-token-keyword);">WHERE</span><span style="color:var(--shiki-color-text);"> e.cid </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> c.cid) </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> t1,</span></span>
<span data-line><span style="color:var(--shiki-color-text);">LATERAL (</span><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">AVG</span><span style="color:var(--shiki-color-text);">(gpa) </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> student </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> s </span><span style="color:var(--shiki-token-keyword);">JOIN</span><span style="color:var(--shiki-color-text);"> enrolled </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> e </span><span style="color:var(--shiki-token-keyword);">ON</span><span style="color:var(--shiki-color-text);"> s.sid </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> e.sid </span><span style="color:var(--shiki-token-keyword);">WHERE</span><span style="color:var(--shiki-color-text);"> e.cid </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> c.cid) </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> t2;</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240708141136.png" width="auto" height="auto"/></p>
</blockquote>
<h2 id="common-table-expression-cte">Common Table Expression (CTE)<a aria-hidden="true" tabindex="-1" href="#common-table-expression-cte" class="internal"> §</a></h2>
<ul>
<li>기존의 Nested query 에서와 유사하게 query 안에 query 를 담는 것이긴 한데</li>
<li>Nested query 에서는 한 inner query 는 한 outer query 에 종속되어 여기에서만 사용 가능했다면</li>
<li><em>Common Table Expression</em> (<em>CTE</em>) 는 query 외부에 저장해 다른 query 에서도 사용할 수 있게 해놓은 것이다.
<ul>
<li>비유하자면 Nested query 는 local variable, CTE 는 global variable 과 같은 느낌이다.</li>
</ul>
</li>
<li>이놈은 <code>WITH ... AS ()</code> 문법을 사용한다.</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">WITH</span><span style="color:var(--shiki-color-text);"> maxGPA </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> (</span></span>
<span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">MAX</span><span style="color:var(--shiki-color-text);">(gpa) </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> student</span></span>
<span data-line><span style="color:var(--shiki-color-text);">)</span></span>
<span data-line> </span>
<span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> maxGPA;</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240708142059.png" width="auto" height="auto"/></p>
<ul>
<li>Column 이름을 붙이는 것도 가능하다.</li>
</ul>
<div data-rehype-pretty-code-fragment><div data-rehype-pretty-code-title data-language="sql" data-theme="default">PostgreSQL</div><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="sql" data-theme="default"><code data-language="sql" data-theme="default"><span data-line data-highlighted-line><span style="color:var(--shiki-token-keyword);">WITH</span><span style="color:var(--shiki-color-text);"> maxGPA (mx, mn) </span><span style="color:var(--shiki-token-keyword);">AS</span><span style="color:var(--shiki-color-text);"> (</span></span>
<span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">MAX</span><span style="color:var(--shiki-color-text);">(gpa), </span><span style="color:var(--shiki-token-function);">MIN</span><span style="color:var(--shiki-color-text);">(gpa) </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> student</span></span>
<span data-line><span style="color:var(--shiki-color-text);">)</span></span>
<span data-line> </span>
<span data-line><span style="color:var(--shiki-token-keyword);">SELECT</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">FROM</span><span style="color:var(--shiki-color-text);"> maxGPA;</span></span></code></pre></div>
<p><img src="../../images/Pasted-image-20240708142232.png" width="auto" height="auto"/></p></article></div><div class="right sidebar"><div class="graph "><h3>Graph View</h3><div class="graph-outer"><div id="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[]}"></div><svg version="1.1" id="global-graph-icon" xmlns="http://www.w3.org/2000/svg" xmlnsXlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xmlSpace="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
	s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
	c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
	C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
	c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
	v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
	s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
	C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
	S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
	s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
	s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></div><div id="global-graph-outer"><div id="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[]}"></div></div></div><div class="toc desktop-only"><button type="button" id="toc"><h3>Table of Contents</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="toc-content"><ul class="overflow"><li class="depth-0"><a href="#history" data-for="history">History</a></li><li class="depth-0"><a href="#sql" data-for="sql">SQL</a></li><li class="depth-0"><a href="#aggregation-function" data-for="aggregation-function">Aggregation function</a></li><li class="depth-0"><a href="#group-by" data-for="group-by">GROUP BY</a></li><li class="depth-0"><a href="#having" data-for="having">HAVING</a></li><li class="depth-0"><a href="#string" data-for="string">String</a></li><li class="depth-1"><a href="#constant" data-for="constant">Constant</a></li><li class="depth-1"><a href="#like" data-for="like">LIKE</a></li><li class="depth-1"><a href="#functions" data-for="functions">Functions</a></li><li class="depth-1"><a href="#concat" data-for="concat">Concat</a></li><li class="depth-0"><a href="#date--time" data-for="date--time">Date &amp; Time</a></li><li class="depth-1"><a href="#현재-날짜-시간" data-for="현재-날짜-시간">현재 날짜, 시간</a></li><li class="depth-1"><a href="#string---date-변환" data-for="string---date-변환">String -> Date 변환</a></li><li class="depth-1"><a href="#날짜-차이" data-for="날짜-차이">날짜 차이</a></li><li class="depth-1"><a href="#extract" data-for="extract">EXTRACT</a></li><li class="depth-0"><a href="#왜-이렇게-문법이-지멋대로일까" data-for="왜-이렇게-문법이-지멋대로일까">왜 이렇게 문법이 지멋대로일까</a></li><li class="depth-0"><a href="#window-function" data-for="window-function">Window function</a></li><li class="depth-1"><a href="#row_number" data-for="row_number">ROW_NUMBER()</a></li><li class="depth-1"><a href="#over-partition-by" data-for="over-partition-by">OVER(), PARTITION BY</a></li><li class="depth-1"><a href="#order-by" data-for="order-by">ORDER BY</a></li><li class="depth-1"><a href="#rank" data-for="rank">RANK()</a></li><li class="depth-0"><a href="#nested-sub-query" data-for="nested-sub-query">Nested (Sub) query</a></li><li class="depth-1"><a href="#operators" data-for="operators">Operators</a></li><li class="depth-0"><a href="#explain" data-for="explain">EXPLAIN</a></li><li class="depth-0"><a href="#lateral" data-for="lateral">LATERAL</a></li><li class="depth-1"><a href="#예제1" data-for="예제1">예제1</a></li><li class="depth-0"><a href="#common-table-expression-cte" data-for="common-table-expression-cte">Common Table Expression (CTE)</a></li></ul></div></div><div class="backlinks "><h3>Backlinks</h3><ul class="overflow"><li><a href="../../originals/15445-idbs.fall.2023.cs.cmu.edu/(CMU-15-445)-Intro.-to-Database-Systems" class="internal">(CMU 15-445) Intro. to Database Systems</a></li></ul></div></div></div><footer class><hr/><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.1.0</a>, © 2024</p><ul><li><a href="https://github.com/haeramkeem">GitHub</a></li><li><a href="www.linkedin.com/in/haeram-kim-277404220">LinkedIn</a></li><li><a href="mailto:haeram.kim1@gmail.com">Email</a></li></ul></footer></div></body><script type="application/javascript">// quartz/components/scripts/quartz/components/scripts/callout.inline.ts
function toggleCallout() {
  const outerBlock = this.parentElement;
  outerBlock.classList.toggle(`is-collapsed`);
  const collapsed = outerBlock.classList.contains(`is-collapsed`);
  const height = collapsed ? this.scrollHeight : outerBlock.scrollHeight;
  outerBlock.style.maxHeight = height + `px`;
  let current = outerBlock;
  let parent = outerBlock.parentElement;
  while (parent) {
    if (!parent.classList.contains(`callout`)) {
      return;
    }
    const collapsed2 = parent.classList.contains(`is-collapsed`);
    const height2 = collapsed2 ? parent.scrollHeight : parent.scrollHeight + current.scrollHeight;
    parent.style.maxHeight = height2 + `px`;
    current = parent;
    parent = parent.parentElement;
  }
}
function setupCallout() {
  const collapsible = document.getElementsByClassName(
    `callout is-collapsible`
  );
  for (const div of collapsible) {
    const title = div.firstElementChild;
    if (title) {
      title.removeEventListener(`click`, toggleCallout);
      title.addEventListener(`click`, toggleCallout);
      const collapsed = div.classList.contains(`is-collapsed`);
      const height = collapsed ? title.scrollHeight : div.scrollHeight;
      div.style.maxHeight = height + `px`;
    }
  }
}
document.addEventListener(`nav`, setupCallout);
window.addEventListener(`resize`, setupCallout);
</script><script type="module">
          import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
          const darkMode = document.documentElement.getAttribute('saved-theme') === 'dark'
          mermaid.initialize({
            startOnLoad: false,
            securityLevel: 'loose',
            theme: darkMode ? 'dark' : 'default'
          });
          document.addEventListener('nav', async () => {
            await mermaid.run({
              querySelector: '.mermaid'
            })
          });
          </script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/copy-tex.min.js" type="application/javascript"></script><script src="https://www.googletagmanager.com/gtag/js?id=G-N68CCP1QHG" type="application/javascript"></script><script src="../../postscript.js" type="module"></script></html>