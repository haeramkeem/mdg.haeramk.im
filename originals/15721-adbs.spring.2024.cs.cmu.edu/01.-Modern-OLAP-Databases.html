<!DOCTYPE html>
<html><head><title>01. Modern OLAP Databases</title><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:title" content="01. Modern OLAP Databases"/><meta property="og:description" content="CMU CS DB Andy Pavlo 교수님의 &amp;quot;Advanced Database Systems&amp;quot; 강의를 필기한 내용입니다. 강의 본 글의 그림들은 별도의 명시가 없는 한 해당 강의 자료에서 가져왔습니다. 다소 잘못된 내용과 구어적 표현 이 포함되어 있을 수 있습니다."/><meta property="og:image" content="https://mdg.haeramk.im/static/og-image.png"/><meta property="og:width" content="1200"/><meta property="og:height" content="675"/><link rel="icon" href="../../static/icon.png"/><meta name="description" content="CMU CS DB Andy Pavlo 교수님의 &amp;quot;Advanced Database Systems&amp;quot; 강의를 필기한 내용입니다. 강의 본 글의 그림들은 별도의 명시가 없는 한 해당 강의 자료에서 가져왔습니다. 다소 잘못된 내용과 구어적 표현 이 포함되어 있을 수 있습니다."/><meta name="generator" content="Quartz"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link href="../../index.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://fonts.googleapis.com/css2?family=IBM Plex Mono&amp;family=Gowun Batang:wght@400;700&amp;family=Gowun Dodum:ital,wght@0,400;0,600;1,400;1,600&amp;display=swap" rel="stylesheet" type="text/css" spa-preserve/><script src="../../prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch(`../../static/contentIndex.json`).then(data => data.json())</script></head><body data-slug="originals/15721-adbs.spring.2024.cs.cmu.edu/01.-Modern-OLAP-Databases"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h1 class="page-title "><a href="../..">Madison Digital Garden</a></h1><div class="spacer mobile-only"></div><div class="search "><div id="search-icon"><p>Search</p><div></div><svg tabIndex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search</title><desc id="desc">Search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg></div><div id="search-container"><div id="search-space"><input autocomplete="off" id="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div id="results-container"></div></div></div></div><div class="darkmode "><input class="toggle" id="darkmode-toggle" type="checkbox" tabIndex="-1"/><label id="toggle-label-light" for="darkmode-toggle" tabIndex="-1"><svg xmlns="http://www.w3.org/2000/svg" xmlnsXlink="http://www.w3.org/1999/xlink" version="1.1" id="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35;" xmlSpace="preserve"><title>Light mode</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg></label><label id="toggle-label-dark" for="darkmode-toggle" tabIndex="-1"><svg xmlns="http://www.w3.org/2000/svg" xmlnsXlink="http://www.w3.org/1999/xlink" version="1.1" id="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'" xmlSpace="preserve"><title>Dark mode</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></label></div></div><div class="center"><div class="page-header"><div class="popover-hint"><h1 class="article-title ">01. Modern OLAP Databases</h1><p class="content-meta ">Jul 08, 2024, 17 min read</p><ul class="tags "><li><a href="../../tags/database" class="internal tag-link">#database</a></li><li><a href="../../tags/cmu-15445" class="internal tag-link">#cmu-15445</a></li></ul></div></div><article class="popover-hint"><blockquote class="callout is-collapsible is-collapsed" data-callout="info" data-callout-fold>
<div class="callout-title">
                  <div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg></div>
                  <div class="callout-title-inner"><p>CMU CS DB Andy Pavlo 교수님의 &quot;Advanced Database Systems&quot; 강의를 필기한 내용입니다. </p></div>
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
                </div>
<ul>
<li><a href="https://youtu.be/5J-I8Mj8tss?si=Eu60uUnAc6xl4fZ3" class="external">강의</a></li>
</ul>
</blockquote>
<blockquote class="callout" data-callout="info">
<div class="callout-title">
                  <div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg></div>
                  <div class="callout-title-inner"><p>본 글의 그림들은 별도의 명시가 없는 한 해당 강의 자료에서 가져왔습니다. </p></div>
                  
                </div>
</blockquote>
<blockquote class="callout" data-callout="warning">
<div class="callout-title">
                  <div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg></div>
                  <div class="callout-title-inner"><p>다소 잘못된 내용과 구어적 표현 이 포함되어 있을 수 있습니다. </p></div>
                  
                </div>
</blockquote>
<blockquote class="callout" data-callout="warning">
<div class="callout-title">
                  <div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg></div>
                  <div class="callout-title-inner"><p>#draft Overview 이기에 내용이 다소 추상적입니당 (나중에 좀 더 명확해지면 설명 추가) </p></div>
                  
                </div>
</blockquote>
<h2 id="oltp-olap-etl-1-2-3">OLTP, OLAP, ETL <sup><a href="#user-content-fn-oltp" id="user-content-fnref-oltp" data-footnote-ref aria-describedby="footnote-label" class="internal">1</a></sup> <sup><a href="#user-content-fn-olap" id="user-content-fnref-olap" data-footnote-ref aria-describedby="footnote-label" class="internal">2</a></sup> <sup><a href="#user-content-fn-etl" id="user-content-fnref-etl" data-footnote-ref aria-describedby="footnote-label" class="internal">3</a></sup><a aria-hidden="true" tabindex="-1" href="#oltp-olap-etl-1-2-3" class="internal"> §</a></h2>
<ul>
<li><em>On-Line Transaction Processing</em> (<em>OLTP</em>) 은 실시간으로 DBMS 의 트랜젝션을 처리하는 시스템을 일컫는다.
<ul>
<li>즉, <span class="text-highlight">최대한 빠르게 데이터를 DBMS 에 주입하고 꺼낼 수 있게 해주는 시스템</span>인 것.</li>
</ul>
</li>
<li><em>On-Line Analytical Processing</em> (<em>OLAP</em>) 은 실시간으로 DBMS 에 담긴 데이터를 분석해주는 시스템을 일컫는다.
<ul>
<li>단순히 데이터를 받아오는 것이 아니라,</li>
<li><em>OLTP</em> 에 쌓인 데이터를 <span class="text-highlight">분석하여 나온 새로운 데이터를 사용자에게 제공하는 시스템</span>인 것.</li>
</ul>
</li>
<li><em>Extract, Transform, Load</em> (<em>ETL</em>) 은 이 <em>OLTP</em> 에 쌓인 데이터를 분석에 사용하기 용이한 형태로 바꿔서 <em>OLAP</em> 에 넣어주는 변환 시스템을 일컫는다.
<ul>
<li>이 ETL 은 그냥 단순히 데이터를 바꾸는 것 뿐 아니라, 중복된 데이터를 합치는 등의 작업도 한다고 한다.</li>
</ul>
</li>
</ul>
<h2 id="background-3">Background <sup><a href="#user-content-fn-etl" id="user-content-fnref-etl-2" data-footnote-ref aria-describedby="footnote-label" class="internal">3</a></sup><a aria-hidden="true" tabindex="-1" href="#background-3" class="internal"> §</a></h2>
<ul>
<li>문제의 시작은 기존의 <em>Monolithic</em>, <em>Row-store</em> DBMS 이다.
<ul>
<li>너가 아는 대부분의 DBMS 들이 다 이런 방식이다.</li>
<li><em>Monolithic</em> - 하나의 binary 를 이용해 모든 데이터들을 저장하고 질의할 수 있고</li>
<li><em>Row-store</em> - 모든 데이터들이 table 에 row (tuple) 로서 저장되는</li>
</ul>
</li>
<li>근데 문제는 이게 analytics 관점에서 별로라는 것이다.
<ul>
<li>가령 IoT 시스템에서 특정 센서값의 변화 추이를 보고 싶다고 해보자.</li>
<li>그럼 해당 테이블에서 모든 row 에 대한 page 들을 전부 꺼낸 다음에</li>
<li>해당 센서값에 해당하는 domain 들을 전부 추려서</li>
<li>그것으로 분석을 해야 한다.</li>
<li>근데 보다시피, 모든 page 들이 다 들춰지기 때문에 실제로 사용되지 않는 데이터들에 대한 IO 가 발생하고, 이것이 비효율성을 낳는다는 것.</li>
</ul>
</li>
<li>그래서 이 문제를 해결하기 위한 방법들이 나오게 되는데…</li>
</ul>
<h3 id="1990s---data-cubes-4">1990s - Data Cubes <sup><a href="#user-content-fn-data-cube" id="user-content-fnref-data-cube" data-footnote-ref aria-describedby="footnote-label" class="internal">4</a></sup><a aria-hidden="true" tabindex="-1" href="#1990s---data-cubes-4" class="internal"> §</a></h3>
<p><img src="../../images/Pasted-image-20240708160039.png" width="auto" height="auto"/></p>
<ul>
<li><em>Data Cube</em> 라는 것은 한줄로 요약하면 <em>Pre-computed aggregation</em> 이다.
<ul>
<li>기존의 RDBMS 에서 <code>AVG</code> 와 같은 aggregation 기억나제?</li>
<li>이런 것들을 미리 다 계산해 놓은 다음에 저장해 놨다가</li>
<li>이것에 대한 질의가 들어오면 얘네들만 꺼내서 반환하는 것.</li>
</ul>
</li>
<li>이것은 DBA 가 어떤 것을 cube 로 만들지 지정해 놓으면, (가령 매일 밤에 cron job 을 돌리는 것과 같은) 특정 때에 얘네들이 계산되어 저장되고, 이에 대한 query 가 들어오면 계산해 놓은 cube 들을 이용해 응답하는 방식으로 이루어진다.</li>
</ul>
<h3 id="2000s---data-warehouse-5">2000s - Data Warehouse <sup><a href="#user-content-fn-data-warehouse" id="user-content-fnref-data-warehouse" data-footnote-ref aria-describedby="footnote-label" class="internal">5</a></sup><a aria-hidden="true" tabindex="-1" href="#2000s---data-warehouse-5" class="internal"> §</a></h3>
<p><img src="../../images/Pasted-image-20240708162624.png" width="auto" height="auto"/></p>
<ul>
<li>얘네들은 기존의 Monolithic DBMS 를 analytic-friendly 하게 수정한 것들을 일컫는다.
<ul>
<li>대부분의 시스템들이 PostgreSQL 를 기반으로 하고 있다고 한다.</li>
<li>가령 PostgreSQL 을 fork 해서 만든 monetDB 는 추후에 DuckDB 가 된다.
<ul>
<li>이게 DuckDB 가 PostgreSQL 과 유사한 인터페이스를 가지고 있는 이유이다.</li>
</ul>
</li>
</ul>
</li>
<li>얘네들의 특징은
<ul>
<li><em>Column-store</em>: 기존의 DBMS 에서 row-store 와 관련된 부분을 걷어내고 이것들을 column-store 로 바꿔서 저런 analytical workload 에 잘 대응할 수 있도록 했다고 한다.
<ul>
<li>그리고 대부분의 경우 특정 솔루션 혹은 벤더사에서만 사용할 수 있는 proprietary data format (encoding) 을 사용한다고 한다.</li>
<li>그래서 위와 같은 <em>ETL</em> 이 도입되고</li>
<li>효과적인 ETL 을 위해, 그리고 Data Warehouse 시스템이 모든 데이터들에 대해 주도권을 갖고 있게 하기 위해 OLTP 에 데이터가 주입되기 전에 Schema 가 다 저장되어야 한다고 한다.</li>
</ul>
</li>
<li><em>Shared-nothing architecture</em>: 데이터를 분산 저장할 때, 각 노드들이 겹치는 부분 없이 전체 데이터의 일정 부분을 갖고 있게끔 설계한다고 한다.
<ul>
<li>어쨋든 이 구조때문에 용량을 늘리려면 새로운 node 를 추가해야만 하고,</li>
<li>이것이 이 시스템의 한계점으로 꼽힌다고 한다.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="2010s---shared-disk-engine-6">2010s - Shared-disk Engine <sup><a href="#user-content-fn-data-lake" id="user-content-fnref-data-lake" data-footnote-ref aria-describedby="footnote-label" class="internal">6</a></sup><a aria-hidden="true" tabindex="-1" href="#2010s---shared-disk-engine-6" class="internal"> §</a></h3>
<p><img src="../../images/Pasted-image-20240708171428.png" width="auto" height="auto"/></p>
<ul>
<li>이전에는 DBMS 내에서 storage management 까지 전부 담당했다면,</li>
<li>이때부터는 (AWS S3 와 같은) 외부 스토리지에 데이터를 저장하고 DBMS 에서는 “연산” 에만 집중하게끔 트렌드가 바뀐다.
<ul>
<li>DBMS 에서 storage 를 관리하는 부담 (뭐 개발, 유지보수에의 영향 뿐 아니라 DBMS 가 소모하는 CPU 등의 자원 등의 측면에서도) 을 줄일 수 있었다.</li>
</ul>
</li>
<li>이 방식의 초기에는 data injection 을 위해서는 DBMS 를 거쳐야만 하고, 따라서 특정 format 으로 데이터가 저장되는 제약조건이 걸리게 된다.</li>
<li>하지만 나중에는 이러한 제약조건을 허물어,
<ul>
<li>(1) DBMS 를 거치지 않고 바로 외부 스토리지에 데이터를 집어넣을 수 있게 하고</li>
<li>(2) 특정 data format 을 강제하는 방식이 아닌 먼저 데이터를 집어넣은 다음, 어느 위치에 어느 형태로 데이터가 저장되어있는지 알려주는 방식으로 변경된다.
<ul>
<li>이놈이 <em>Catalog</em> 이다; 사용자는 Catalog 에다가 데이터가 저장된 위치와 어떻게 읽어야 하는지를 알려 OLAP 에서 사용할 수 있게 한다.</li>
<li>다만 그렇다고 format 이 아예 없는 것은 아닌듯; <a href="https://parquet.apache.org/" class="external">Apache Parquet</a> 와 같은 형식을 사용하긴 하지만 특정 DBMS 에 종속되어 있지는 않다는 의미로 받아들이면 된다.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="2020s---data-lakehouse-6">2020s - Data Lakehouse <sup><a href="#user-content-fn-data-lake" id="user-content-fnref-data-lake-2" data-footnote-ref aria-describedby="footnote-label" class="internal">6</a></sup><a aria-hidden="true" tabindex="-1" href="#2020s---data-lakehouse-6" class="internal"> §</a></h3>
<ul>
<li><em>Data Lakehouse</em> 는 기존의 시스템에서 더 나은 schema control 과 versioning 을 제공하는 것이라고 한다.</li>
<li>여기서는 row-data 를 log structure 로 저장하고, 추후에 이것을 column-data 로 변환하며 stale data 를 정리하는 compaction 을 거친다고 한다.</li>
<li>이 Lakehouse system 이 나오게 된 배경은 다음과 같다:
<ul>
<li>AI/ML 이 점점 더 중요해짐에 따라, SQL (+ 혹은 OLAP query) 가 아닌 방식으로 데이터를 조회하는 것에 대한 요구가 점점 증가했다.
<ul>
<li>뭐 이런 AI/ML workload 에서는 data access pattern 이 기존의 SQL 을 사용할 때와 특성이 좀 다르다고 이해하면 된다.
<ul>
<li>가령 Pytorch 나 Tensorflow 에서는 SQL 로 데이터를 받아오도록 하는 것이 별로 좋지 않은 갑다.</li>
<li>SQL 에서는 데이터를 가져와 어느정도 가공해서 응답하는데 AI/ML 에서는 그렇지 않다?</li>
</ul>
</li>
</ul>
</li>
<li>그리고 외부 스토리지를 사용함에 따라 DBMS 를 통해서만 데이터를 접근하지 않아도 되었다.
<ul>
<li>누구나 parquet 와 같은 형식으로 데이터를 그냥 외부 스토리지에 투척할 수 있었고, 해당 데이터가 어디에 있는지만 catalog 에 알려주면 되었다.</li>
</ul>
</li>
<li>근래의 많은 데이터들이 unstructured (이미지, 비디오 등) 혹은 semi-structured (XML, JSON 등) 형식을 가진다.
<ul>
<li>즉, SQL 와 같은 structured data 에 대한 수요가 줄었다는 것.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="olap-dbms-component">OLAP DBMS Component<a aria-hidden="true" tabindex="-1" href="#olap-dbms-component" class="internal"> §</a></h2>
<ul>
<li>근래에 나온 또 다른 트렌드는 이전의 monolithic 한 접근과 다르게 DBMS 들의 각 component 들이 분리되어 독자적으로 개발되어 라이브러리나 서비스의 형태로 배포되고 있다는 점이다.</li>
<li>가령, OLAP DBMS 의 다음과 같은 component 들이 개별 배포되고 있다고 한다.
<ul>
<li>System Catalogs</li>
<li>Intermediate Representation (IR)
<ul>
<li>얘는 PL 에서 배운 그 중간 언어이다.</li>
<li>JVM 에서처럼, SQL 은 IR 로 변환되어 처리된다.</li>
</ul>
</li>
<li>Query Optimizers</li>
<li>File Format, Access Libraries
<ul>
<li>아마 여기에 Apache Parquet 가 포함되겠지?</li>
</ul>
</li>
<li>Execution Engines, Fabrics</li>
</ul>
</li>
<li>이런 component project 들은 각자의 API 를 제공하기 때문에, 공개된 component 들만을 조합해서 새로운 OLAP DBMS 를 만드는 것이 가능하다.
<ul>
<li>다만, 중간에 추상화 (API) 가 많이 끼게 되면 그만큼 비효율적으로 작동하기 때문에, 기존의 프로젝트를 재활용하는 것과 성능 간에 밸런스를 맞춰야 한다.</li>
</ul>
</li>
<li>이것과 관련된 논문이 있다고 한다. (<a href="https://www.vldb.org/pvldb/vol16/p2679-pedreira.pdf" class="external">여기</a>)</li>
</ul>
<h2 id="architecture-overview">Architecture Overview<a aria-hidden="true" tabindex="-1" href="#architecture-overview" class="internal"> §</a></h2>
<p><img src="../../images/Pasted-image-20240709153749.png" width="auto" height="auto"/></p>
<ul>
<li>사용자가 query 를 보내면 내부적으로는 위와 같은 일이 벌어진다. 하나하나 살펴보자.</li>
<li><em>Front-end</em>: 얘는 그냥 parser 라고 생각하면 된다. 입력 query (SQL) 를 파싱하여, token 단위 등으로 나눠 IR 로 변환한다.</li>
<li><em>Planner</em>: 얘는 입력받은 IR 를 이용해 (1) 처리가 가능한지 파악하고 (2) 어떻게 처리하는게 효율적인지 파악해서 그 결과로 쿼리를 처리할 계획을 세우는 놈이다.
<ul>
<li>대략 다음과 같은 기능으로 세분화할 수 있다.
<ul>
<li><em>Binder</em>: Token 이 어떤 놈인지 파악한다.
<ul>
<li>가령 이 token 이 실제로 존재하는 table 이름인가 등을 파악하고, 이때 <em>Catalog</em> 의 도움을 받는다.</li>
</ul>
</li>
<li><em>Rewriter</em>: 쿼리 IR 을 좀 더 처리하기 쉬운 형태로 재작성한다.</li>
<li><em>Optimizer</em>: 각 연산의 비용 모델 (<em>Cost Model</em>) 에 따라 연산을 최적화한다.</li>
</ul>
</li>
</ul>
</li>
<li><em>Catalog</em>: 얘는 DB 의 metadata 를 관리하는 역할을 한다.
<ul>
<li>위의 <em>Binder</em> 에서 사용되는 것 처럼, 이 component 는 여러 부분에서 호출되어 사용된다.</li>
</ul>
</li>
<li><em>Scheduler</em>: <em>Planner</em> 가 세운 처리 계획을 이용해, “물리적인” 처리 계획을 세운다.
<ul>
<li><em>Planner</em> 가 logical layer 에서의 처리 계획이었다면, <em>Scheduler</em> 는 physical layer 에서의 처리 계획이라고 생각하면 된다.</li>
<li>이를 위해 <em>Scheduler</em> 는 <em>Catalog</em> 를 이용해 데이터가 어느 위치에 있는지, 만일 분산 저장되어 있으면 어떤 node 에 저장되어 있는지 등을 파악한다.</li>
</ul>
</li>
<li><em>Execution Engine</em>: 얘는 <em>Scheduler</em> 의 처리 계획을 부분적으로 수행하는 놈이라고 생각하면 된다.
<ul>
<li>우선 <em>Scheduler</em> 가 각 처리 계획을 쪼개어 <em>Execution Engine</em> 에게 분배하면</li>
<li><em>Execution Engine</em> 계획을 이행하기 위해 필요한 데이터를 하위 layer 인 <em>IO Service</em> 에게 block request 를 보내어 받아오게 되고</li>
<li>받아온 뒤 여러 연산을 하여 처리한 뒤, 상위 layer (<em>Scheduler</em>) 로 보내 사용자에게 처리 결과를 알려주게 된다.</li>
<li>이와 동시에 <em>Execution Engine</em> 은 <em>Catalog</em> 에 metadata update 를 해준다.
<ul>
<li>이는 <em>Execution Engine</em> 이 처리한 결과에 따라 metadata 가 변경되었을 수도 있기에, 그것을 <em>Catalog</em> 에 알려 반영될 수 있게 하는 것이라 생각하면 된다.</li>
</ul>
</li>
</ul>
</li>
<li><em>IO Service</em>: 얘는 <em>Execution Engine</em> 으로부터 block request 를 받아 해당 데이터를 반환하는 역할이다
<ul>
<li>Block layer 인 셈.</li>
<li>이를 위해 local 의 disk 에 접근하거나 외부 스토리지에 접근하는 등의 작업을 한다.</li>
<li><em>Execution Engine</em> 과 유사하게, <em>IO Service</em> 도 <em>Catalog</em> 와 소통하여 데이터의 물리적인 위치를 알려준다.
<ul>
<li>이는 <em>Catalog</em> 는 storage 에 어떻게 데이터가 저장되어 있는지 정보를 갖고 있긴 하지만, 그것을 실제로 확인하지는 않기 때문이다.</li>
<li>만일 확인하는 기능이 <em>Catalog</em> 에도 포함된다면, 중복된 코드가 포함되기 때문.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="distributed-query-execution">Distributed Query Execution<a aria-hidden="true" tabindex="-1" href="#distributed-query-execution" class="internal"> §</a></h2>
<ul>
<li>거의 대부분의 상용 OLAP DBMS 들은 distributed system 이지만, OLAP query 를 처리하는 과정은 single node system 과 동일하기에, 대부분의 연구는 single node system 을 기반으로 이루어 진다.
<ul>
<li>여러 node 간의 orchestration 은 여러 cpu 간의 orchestration (가령 NUMA 등) 와 동일하게 생각할 수 있기 때문이라고 하는데, 맞는 설명인지는 잘 모르겠다.</li>
</ul>
</li>
<li>어쨋든 query plan 은 이상적으로는 physical operator 들의 DAG (Directed Acyclic Graph) 으로서 표현될 수 있다.
<ul>
<li>“이상적으로는” 이라는 말은 실제 구현에서는 그렇지 않다는 말이다. PostgreSQL 을 포함한 많은 DBMS 는 query plan 을 tree 형태로 구현하고 있다고 한다.</li>
<li>이는 (하나의 예시인지는 모르겠지만) subquery 때문이라고 한다. subquery 의 결과를 다른 여러 plan node 에서 사용해야 하기 때문?</li>
<li>DAG 와 tree 의 가장 큰 차이점은 input 이 한개냐 여러개냐의 차이이기 때문에, 아마 query plan 들의 각 physical operator 들은 하나의 input source 만을 가지게 되지 않을까</li>
<li>그리고 DBMS 는 각 physical operator 에 대해 어디에서 input 이 와서 어디로 output 이 가는지를 고려한다고 한다.</li>
</ul>
</li>
</ul>
<hr/>
<section data-footnotes class="footnotes"><h2 class="sr-only" id="footnote-label">Footnotes<a aria-hidden="true" tabindex="-1" href="#footnote-label" class="internal"> §</a></h2>
<ol>
<li id="user-content-fn-oltp">
<p>이동됨: <a href="../../botanicals/database/terms/modern-dbms/On-Line-Transactional-Processing,-OLTP-(Database)" class="internal" data-slug="botanicals/database/terms/modern-dbms/On-Line-Transactional-Processing,-OLTP-(Database)">On-Line Transactional Processing, OLTP (Database)</a> <a href="#user-content-fnref-oltp" data-footnote-backref class="data-footnote-backref internal" aria-label="Back to content">↩</a></p>
</li>
<li id="user-content-fn-olap">
<p>이동됨: <a href="../../botanicals/database/terms/modern-dbms/On-Line-Analytical-Processing,-OLAP-(Database)" class="internal" data-slug="botanicals/database/terms/modern-dbms/On-Line-Analytical-Processing,-OLAP-(Database)">On-Line Analytical Processing, OLAP (Database)</a> <a href="#user-content-fnref-olap" data-footnote-backref class="data-footnote-backref internal" aria-label="Back to content">↩</a></p>
</li>
<li id="user-content-fn-etl">
<p>이동됨: <a href="../../botanicals/database/terms/modern-dbms/Extract-Transform-Load,-ETL-(Database)" class="internal" data-slug="botanicals/database/terms/modern-dbms/Extract-Transform-Load,-ETL-(Database)">Extract-Transform-Load, ETL (Database)</a> <a href="#user-content-fnref-etl" data-footnote-backref class="data-footnote-backref internal" aria-label="Back to content">↩</a> <a href="#user-content-fnref-etl-2" data-footnote-backref class="data-footnote-backref internal" aria-label="Back to content">↩<sup>2</sup></a></p>
</li>
<li id="user-content-fn-data-cube">
<p>이동됨: <a href="../../botanicals/database/terms/modern-dbms/Data-Cube-(Database)" class="internal" data-slug="botanicals/database/terms/modern-dbms/Data-Cube-(Database)">Data Cube (Database)</a> <a href="#user-content-fnref-data-cube" data-footnote-backref class="data-footnote-backref internal" aria-label="Back to content">↩</a></p>
</li>
<li id="user-content-fn-data-warehouse">
<p>이동됨: <a href="../../botanicals/database/terms/modern-dbms/Data-Warehouse-(Database)" class="internal" data-slug="botanicals/database/terms/modern-dbms/Data-Warehouse-(Database)">Data Warehouse (Database)</a> <a href="#user-content-fnref-data-warehouse" data-footnote-backref class="data-footnote-backref internal" aria-label="Back to content">↩</a></p>
</li>
<li id="user-content-fn-data-lake">
<p>이동됨: <a href="../../botanicals/database/terms/modern-dbms/Data-Lake,-Data-Lakehouse-(Database)" class="internal" data-slug="botanicals/database/terms/modern-dbms/Data-Lake,-Data-Lakehouse-(Database)">Data Lake, Data Lakehouse (Database)</a> <a href="#user-content-fnref-data-lake" data-footnote-backref class="data-footnote-backref internal" aria-label="Back to content">↩</a> <a href="#user-content-fnref-data-lake-2" data-footnote-backref class="data-footnote-backref internal" aria-label="Back to content">↩<sup>2</sup></a></p>
</li>
</ol>
</section></article></div><div class="right sidebar"><div class="graph "><h3>Graph View</h3><div class="graph-outer"><div id="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[]}"></div><svg version="1.1" id="global-graph-icon" xmlns="http://www.w3.org/2000/svg" xmlnsXlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xmlSpace="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
	s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
	c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
	C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
	c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
	v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
	s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
	C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
	S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
	s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
	s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></div><div id="global-graph-outer"><div id="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[]}"></div></div></div><div class="toc desktop-only"><button type="button" id="toc"><h3>Table of Contents</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="toc-content"><ul class="overflow"><li class="depth-0"><a href="#oltp-olap-etl---" data-for="oltp-olap-etl---">OLTP, OLAP, ETL   </a></li><li class="depth-0"><a href="#background-" data-for="background-">Background </a></li><li class="depth-1"><a href="#1990s---data-cubes-" data-for="1990s---data-cubes-">1990s - Data Cubes </a></li><li class="depth-1"><a href="#2000s---data-warehouse-" data-for="2000s---data-warehouse-">2000s - Data Warehouse </a></li><li class="depth-1"><a href="#2010s---shared-disk-engine-" data-for="2010s---shared-disk-engine-">2010s - Shared-disk Engine </a></li><li class="depth-1"><a href="#2020s---data-lakehouse-" data-for="2020s---data-lakehouse-">2020s - Data Lakehouse </a></li><li class="depth-0"><a href="#olap-dbms-component" data-for="olap-dbms-component">OLAP DBMS Component</a></li><li class="depth-0"><a href="#architecture-overview" data-for="architecture-overview">Architecture Overview</a></li><li class="depth-0"><a href="#distributed-query-execution" data-for="distributed-query-execution">Distributed Query Execution</a></li></ul></div></div><div class="backlinks "><h3>Backlinks</h3><ul class="overflow"><li><a href="../../botanicals/database/terms/modern-dbms/Data-Cube-(Database)" class="internal">Data Cube (Database)</a></li><li><a href="../../botanicals/database/terms/modern-dbms/Data-Lake,-Data-Lakehouse-(Database)" class="internal">Data Lake, Data Lakehouse (Database)</a></li><li><a href="../../botanicals/database/terms/modern-dbms/Data-Warehouse-(Database)" class="internal">Data Warehouse (Database)</a></li><li><a href="../../botanicals/database/terms/modern-dbms/Extract-Transform-Load,-ETL-(Database)" class="internal">Extract-Transform-Load, ETL (Database)</a></li><li><a href="../../botanicals/database/terms/modern-dbms/On-Line-Analytical-Processing,-OLAP-(Database)" class="internal">On-Line Analytical Processing, OLAP (Database)</a></li><li><a href="../../botanicals/database/terms/modern-dbms/On-Line-Transactional-Processing,-OLTP-(Database)" class="internal">On-Line Transactional Processing, OLTP (Database)</a></li><li><a href="../../originals/15721-adbs.spring.2024.cs.cmu.edu/(CMU-15-721)-Advanced-Database-Systems" class="internal">(CMU 15-721) Advanced Database Systems</a></li></ul></div></div></div><footer class><hr/><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.1.0</a>, © 2024</p><ul><li><a href="https://github.com/haeramkeem">GitHub</a></li><li><a href="www.linkedin.com/in/haeram-kim-277404220">LinkedIn</a></li><li><a href="mailto:haeram.kim1@gmail.com">Email</a></li></ul></footer></div></body><script type="application/javascript">// quartz/components/scripts/quartz/components/scripts/callout.inline.ts
function toggleCallout() {
  const outerBlock = this.parentElement;
  outerBlock.classList.toggle(`is-collapsed`);
  const collapsed = outerBlock.classList.contains(`is-collapsed`);
  const height = collapsed ? this.scrollHeight : outerBlock.scrollHeight;
  outerBlock.style.maxHeight = height + `px`;
  let current = outerBlock;
  let parent = outerBlock.parentElement;
  while (parent) {
    if (!parent.classList.contains(`callout`)) {
      return;
    }
    const collapsed2 = parent.classList.contains(`is-collapsed`);
    const height2 = collapsed2 ? parent.scrollHeight : parent.scrollHeight + current.scrollHeight;
    parent.style.maxHeight = height2 + `px`;
    current = parent;
    parent = parent.parentElement;
  }
}
function setupCallout() {
  const collapsible = document.getElementsByClassName(
    `callout is-collapsible`
  );
  for (const div of collapsible) {
    const title = div.firstElementChild;
    if (title) {
      title.removeEventListener(`click`, toggleCallout);
      title.addEventListener(`click`, toggleCallout);
      const collapsed = div.classList.contains(`is-collapsed`);
      const height = collapsed ? title.scrollHeight : div.scrollHeight;
      div.style.maxHeight = height + `px`;
    }
  }
}
document.addEventListener(`nav`, setupCallout);
window.addEventListener(`resize`, setupCallout);
</script><script type="module">
          import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
          const darkMode = document.documentElement.getAttribute('saved-theme') === 'dark'
          mermaid.initialize({
            startOnLoad: false,
            securityLevel: 'loose',
            theme: darkMode ? 'dark' : 'default'
          });
          document.addEventListener('nav', async () => {
            await mermaid.run({
              querySelector: '.mermaid'
            })
          });
          </script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/copy-tex.min.js" type="application/javascript"></script><script src="https://www.googletagmanager.com/gtag/js?id=G-N68CCP1QHG" type="application/javascript"></script><script src="../../postscript.js" type="module"></script></html>